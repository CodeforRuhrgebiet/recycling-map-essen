"use strict";var apiUrl="./data/features.json",req=new XMLHttpRequest;req.onreadystatechange=function(){if(4==req.readyState&&200==req.status){var e=JSON.parse(req.responseText);renderMap(e)}},req.open("GET",apiUrl,!0),req.send(),L.RecyclingMarker=L.Marker.extend({initialize:function(e,t){var r=this._generateSegmentsFromTypes(t.types);t.icon=L.segmentedCircleIcon({segments:r,radius:12}),L.Marker.prototype.initialize.call(this,e,t)},_generateSegmentsFromTypes:function(e){return e.map(function(e){return{className:"segment segment--"+e}})}}),L.recyclingMarker=function(e,t){return new L.RecyclingMarker(e,t)};var renderMap=function(e){var t=e.elements,r=(e.generator,e.osm3s,L.map("recycling-map").setView([51.46,7.02],13));L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:18}).addTo(r),L.control.locate().addTo(r);var a=getGeoJSONLayer(t).features,n=function(e){var t=["recycling:glass","recycling:glass_bottles","recycling:paper","recycling:clothes"];return t.filter(function(t){return"yes"===e.properties[t]}).map(function(e){var t=e.slice(e.indexOf(":")+1);return"glass_bottles"===t&&(t="glass"),t}).filter(function(e,t,r){return r.indexOf(e)===t})};L.geoJSON(a,{pointToLayer:function(e,t){var r=n(e);return L.recyclingMarker(t,{types:r})}}).addTo(r)},getGeoJSONLayer=function(e){var t={type:"FeatureCollection",features:[]};return e.map(function(e){t.features.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:e.tags})}),t};
