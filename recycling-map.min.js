"use strict";var apiUrl="./data/features.json",req=new XMLHttpRequest;req.onreadystatechange=function(){if(4==req.readyState&&200==req.status){var e=JSON.parse(req.responseText);renderMap(e)}},req.open("GET",apiUrl,!0),req.send(),L.RecyclingMarker=L.Marker.extend({initialize:function(e,r){var t=this._generateSegmentsFromTypes(r.types);r.icon=L.segmentedCircleIcon({segments:t,radius:12}),L.Marker.prototype.initialize.call(this,e,r)},_generateSegmentsFromTypes:function(e){return e.map(function(e){return{className:"segment segment--"+e}})}}),L.recyclingMarker=function(e,r){return new L.RecyclingMarker(e,r)};var renderMap=function(e){var r=e.elements,t=(e.generator,e.osm3s,L.map("recycling-map").setView([51.46,7.02],13));L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:18}).addTo(t);var a=getGeoJSONLayer(r).features,n=function(e){var r=["recycling:glass","recycling:paper","recycling:clothes"];return r.filter(function(r){return"yes"===e.properties[r]}).map(function(e){return e.slice(e.indexOf(":")+1)})};L.geoJSON(a,{pointToLayer:function(e,r){var t=n(e);return L.recyclingMarker(r,{types:t})}}).addTo(t)},getGeoJSONLayer=function(e){var r={type:"FeatureCollection",features:[]};return e.map(function(e){r.features.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:e.tags})}),r};
