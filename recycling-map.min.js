"use strict";var apiUrl="./data/features.json",req=new XMLHttpRequest;req.onreadystatechange=function(){if(4==req.readyState&&200==req.status){var e=JSON.parse(req.responseText);renderMap(e)}},req.open("GET",apiUrl,!0),req.send(),L.RecyclingIcon=L.SegmentedCircleIcon.extend({initialize:function(e){e.segments=this._generateSegmentsFromTypes(e.types),e.className="segmented-circle-icon";var t=e.segments.length;e.className+=" segmented-circle-icon--"+t+"-segments",L.SegmentedCircleIcon.prototype.initialize.call(this,e)},_generateSegmentsFromTypes:function(e){return e.map(function(e){return{className:"segment segment--"+e}})}}),L.recyclingIcon=function(e,t){return new L.RecyclingIcon(e,t)},L.RecyclingMarker=L.Marker.extend({initialize:function(e,t){t.icon=L.recyclingIcon({types:t.types,radius:12}),L.Marker.prototype.initialize.call(this,e,t)}}),L.recyclingMarker=function(e,t){return new L.RecyclingMarker(e,t)};var renderMap=function(e){var t=e.elements,r=(e.generator,e.osm3s,L.map("recycling-map").setView([51.46,7.02],13));L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:18}).addTo(r),L.control.locate().addTo(r);var n=getGeoJSONLayer(t).features,a=function(e){var t=["recycling:glass","recycling:glass_bottles","recycling:paper","recycling:clothes","recycling:shoes"];return t.filter(function(t){return"yes"===e.properties[t]}).map(function(e){var t=e.slice(e.indexOf(":")+1);return"glass_bottles"===t&&(t="glass"),"shoes"===t&&(t="clothes"),t}).filter(function(e,t,r){return r.indexOf(e)===t})},o=L.geoJSON(n,{pointToLayer:function(e,t){var r=a(e);return L.recyclingMarker(t,{types:r})}}),s=function(e){var t=e.getAllChildMarkers(),r=[];return t.forEach(function(e){var t=a(e.feature);t.forEach(function(e){r.indexOf(e)<0&&r.push(e)})}),L.recyclingIcon({radius:12,types:r})},i=L.markerClusterGroup({iconCreateFunction:s,disableClusteringAtZoom:18,showCoverageOnHover:!1,spiderfyOnMaxZoom:!1});i.addLayer(o).addTo(r)},getGeoJSONLayer=function(e){var t={type:"FeatureCollection",features:[]};return e.map(function(e){t.features.push({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:e.tags})}),t};
